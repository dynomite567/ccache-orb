description: >
  Restores the existing cache from the CircleCI cache store. 
  If one doesn't exist, it will simply configure itself.
parameters:
  max-size:
    type: string
    default: "500M"
    description: "Max size of the cache"
  create-symlinks:
    type: boolean
    default: true
    description: "Should the orb create necessary symlinks for the executors? (Default is yes)"
  
steps:
  - restore_cache:
        keys: ccache-

  - run:
      name: Setup ccache
      command: |
        ccache --set-config=cache_dir='/home/circleci/project/${CIRCLE_PROJECT_REPONAME}/.ccache'
        ccache --set-config=max_size='$<< parameters.max-size >>'
        ccache --set-config=compression=true
        ccache -p
        ccache -z

  - when:
      condition: << parameters.create-symlinks >>
      steps:
        - run: sudo /usr/sbin/update-ccache-symlinks
